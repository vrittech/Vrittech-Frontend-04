<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <title>DASHBOARD</title>
  </head>
  <body>
    <div class="container">
      <button
        type="button"
        class="btn btn-outline-primary"
        data-bs-toggle="modal"
        data-bs-target="#exampleModa"
      >
        Add Product
      </button>
      <div id="container"></div>
      <!--Add Product Modal -->
      <div
        class="modal fade"
        id="exampleModa"
        tabindex="-1"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">
                Add Product Form
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <div class="form-floating mb-3">
                <input
                  type="text"
                  class="form-control"
                  id="imageURL"
                  placeholder="Enter image url here"
                />
                <label for="imageURL">Product Image URL</label>
              </div>
              <div class="form-floating mb-3">
                <input
                  type="text"
                  class="form-control"
                  id="title"
                  placeholder="Product Title"
                />
                <label for="title">Product Title</label>
              </div>
              <div class="row mb-3">
                <div class="col-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      class="form-control"
                      id="price"
                      placeholder="Product price"
                    />
                    <label for="price">Product price</label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="category"
                      placeholder="Product category"
                    />
                    <label for="category">Product category</label>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="form-floating">
                  <textarea
                    class="form-control"
                    placeholder="Product Description"
                    id="description"
                  ></textarea>
                  <label for="description">Description</label>
                </div>
              </div>
            </div>

            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
                id="closebtn"
              >
                Close
              </button>
              <button
                type="button"
                class="btn btn-primary"
                onclick="addProduct()"
              >
                Add Product
              </button>
            </div>
          </div>
        </div>
      </div>
      <!--View Product Modal -->
      <div
        class="modal fade"
        id="viewModal"
        tabindex="-1"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">
                View Product Details
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <div class="form-floating mb-3">
                <img id="view-imageURL" width="300" height="300" alt="" />
              </div>
              <div class="form-floating mb-3">
                <input
                  type="text"
                  class="form-control"
                  id="view-title"
                  placeholder="Product Title"
                />
                <label for="title">Product Title</label>
              </div>
              <div class="row mb-3">
                <div class="col-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      class="form-control"
                      id="view-price"
                      placeholder="Product price"
                    />
                    <label for="price">Product price</label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="view-category"
                      readonly
                      placeholder="Product category"
                    />
                    <label for="category">Product category</label>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="form-floating">
                  <textarea
                    class="form-control"
                    placeholder="Product Description"
                    id="view-description"
                  ></textarea>
                  <!-- <label for="description">Description</label> -->
                </div>
              </div>
            </div>

            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
                id="closebtn"
              >
                Close
              </button>
            </div>
          </div>
        </div>
      </div>
      <!--Edit Product Modal -->
      <div
        class="modal fade"
        id="editModal"
        tabindex="-1"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">
                Edit Product Details
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <div class="form-floating mb-3">
                <input
                  type="text"
                  class="form-control"
                  id="edit-imageURL"
                  placeholder="Enter image url here"
                />
                <label for="imageURL">Product Image URL</label>
              </div>
              <div class="form-floating mb-3">
                <input
                  type="text"
                  class="form-control"
                  id="edit-title"
                  placeholder="Product Title"
                />
                <label for="title">Product Title</label>
              </div>

              <div class="row">
                <div class="form-floating">
                  <textarea
                    class="form-control"
                    placeholder="Product Description"
                    id="edit-description"
                  ></textarea>
                  <label for="description">Description</label>
                </div>
              </div>
            </div>

            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
                id="edit-closebtn"
              >
                Close
              </button>
              <button
                type="button"
                class="btn btn-success"
                onclick="editProduct()"
              >
                Edit
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // fetch("https://dummyjson.com/products")
      //   .then((resp) => {
      //     return resp.json();
      //   })
      //   .then((value) => {
      //     console.log(value);
      //   });

      let actualProduct = [];
      let productId = "";

      const container = document.getElementById("container");
      container.style.display = "flex";
      container.style.flexWrap = "wrap";
      container.style.gap = "30px";

      const fetchProducts = async () => {
        const resp = await fetch("https://dummyjson.com/products");
        const { products } = await resp.json();
        actualProduct = products;
        newProducts(products);
      };

      const newProducts = (products) => {
        container.innerHTML = "";
        for (let product of products) {
          const card = document.createElement("div");
          card.style.width = "22%";
          card.style.height = "400px";
          card.className = "card d-flex";

          const cardHeader = document.createElement("div");
          cardHeader.className = "card-header h-50";

          const image = document.createElement("img");
          image.src = product.thumbnail;
          image.classList = "h-100 w-100";

          cardHeader.append(image);

          card.append(cardHeader);

          const h2 = document.createElement("h2");
          h2.innerText =
            product.title.length > 14
              ? product.title.slice(0, 13) + "..."
              : product.title;

          card.append(h2);

          const p = document.createElement("p");
          p.innerText = product.description.slice(0, 14) + "...";

          const editbutton = document.createElement("button");
          editbutton.innerText = "Edit";
          editbutton.classList.add(
            "btn",
            "btn-outline-secondary",
            "btn-sm",
            "mb-2"
          );

          // window.location.href="edit-form.html"
          editbutton.setAttribute("data-bs-toggle", "modal");
          editbutton.setAttribute("data-bs-target", "#editModal");
          editbutton.addEventListener("click", (event) => {
            event.preventDefault();

            productId = product.id;
            // 2nd step -> set actual value of that product
            const imageURL = document.getElementById("edit-imageURL");
            imageURL.value = product.thumbnail;
            const title = document.getElementById("edit-title");
            title.value = product.title;
            const description = document.getElementById("edit-description");
            description.value = product.description;
          });

          const button = document.createElement("button");
          button.innerText = "Delete";

          const viewBtn = document.createElement("button");
          viewBtn.innerText = "View";

          viewBtn.setAttribute("data-bs-toggle", "modal");
          viewBtn.setAttribute("data-bs-target", "#viewModal");
          viewBtn.classList.add(
            "btn",
            "btn-outline-secondary",
            "btn-sm",
            "mb-2"
          );
          viewBtn.addEventListener("click", (event) => {
            event.preventDefault();
            document.getElementById("view-imageURL").src = product.thumbnail;
            setreadonly(document.getElementById("view-title"));
            setreadonly(document.getElementById("view-price"));
            document.getElementById("view-title").value = product.title;
            document.getElementById("view-price").value = product.price;
            document.getElementById("view-category").value = product.category;
            document.getElementById("view-description").value =
              product.description;
          });

          button.classList.add("btn", "btn-outline-danger", "btn-sm", "mb-2");
          button.addEventListener("click", (event) => {
            event.preventDefault();
            const filteredProduct = products.filter((prod) => {
              // if (prod.id !== product.id) {
              //   return true;
              // }
              return prod.id !== product.id;
            });
            newProducts(filteredProduct);
          });

          card.append(p);
          card.append(viewBtn);
          card.append(editbutton);
          card.append(button);

          container.append(card);
        }
      };
      function setreadonly(element) {
        element.setAttribute("readOnly", "true");
      }
      fetchProducts();
      // 3rd step
      function editProduct() {
        const title = document.getElementById("edit-title").value;
        const description = document.getElementById("edit-description").value;
        const imageURL = document.getElementById("edit-imageURL").value;
        const editedFinalData = {
          id: productId,
          title,
          description,
          thumbnail: imageURL,
        };

        const editedProductData = actualProduct.map((product) => {
          if (product.id === productId) {
            return editedFinalData;
          } else {
            return product;
          }
          // return product.id === productId ? editedFinalData : product;
        });

        actualProduct = editedProductData;

        newProducts(editedProductData);

        document.getElementById("edit-closebtn").click();
      }

      function addProduct() {
        const imageURL = document.querySelector("#imageURL").value;
        const abc = document.querySelector("#title").value;

        const description = document.querySelector("#description").value;
        let newProduct = {
          id: Date.now(),
          title: abc,
          description,
          thumbnail: imageURL,
        };
        //API call -> POST METHOD
        actualProduct = [newProduct, ...actualProduct];
        newProducts(actualProduct);
        document.getElementById("closebtn").click();
      }
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
